pub enum PortStatus {
    CONNECTED,
    DISCONNECTED,
}

pub enum PortSpeed {
    LOW_SPEED,
    FULL_SPEED,
}

pub struct Port {
    num: u32,
    status: PortStatus,
    speed: PortSpeed,
}

#[repr(packed)]
pub struct SetupPacket {
    request_type: u8,
    request: u8,
    value: u16,
    index: u16,
    length: u16,
}

pub enum TransferType {
    ControlRead(SetupPacket),
    ControlWrite(SetupPacket),
    BulkWrite,
    BulkRead,
    InterruptOut,
    InterruptIn,
}

pub struct UsbTransfer<'a> {
    transfer_type: TransferType,
    buffer: &'a mut [u8],
    poll: bool,
}

pub trait UsbHCI {
    fn get_ports(&self) -> Vec<Port>;
    fn transfer(&self, transfer: UsbTranser);
}

struct Usb {
    hcis: Vec<Box<dyn UsbHCI>>,
    arena: arena::Arena,
}



unsafe impl Send for Usb { }
unsafe impl Sync for Usb { }

impl driver::Bus for Usb {
    fn name(&self) -> String {
	String::from("USB")
    }

    fn enumerate(&mut self) -> Vec<Box<dyn driver::DeviceTypeIdentifier>> {
	Vec::new()
    }
}
